/*! Studio-v2 - v2.0.0 - 2014-02-20
* https://github.com/kaltura/player-studio
* Copyright (c) 2014 Kaltura */
"use strict";angular.module("colorpicker.module",[]).factory("helper",function(){return{closest:function(a,b){for(var c=a.matches||a.webkitMatchesSelector||a.mozMatchesSelector||a.msMatchesSelector;a;){if(c.bind(a)(b))return a;a=a.parentNode}return!1},getOffset:function(a){for(var b=0,c=0;a&&!isNaN(a.offsetLeft)&&!isNaN(a.offsetTop);)b+=a.offsetLeft+a.scrollLeft,c+=a.offsetTop+a.scrollTop,a=a.offsetParent;return{top:c,left:b}},extend:function(){for(var a=1;a<arguments.length;a++)for(var b in arguments[a])arguments[a].hasOwnProperty(b)&&(arguments[0][b]=arguments[a][b]);return arguments[0]},stringParsers:[{re:/rgba?\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[a[1],a[2],a[3],a[4]]}},{re:/rgba?\(\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*,\s*(\d+(?:\.\d+)?)\%\s*(?:,\s*(\d+(?:\.\d+)?)\s*)?\)/,parse:function(a){return[2.55*a[1],2.55*a[2],2.55*a[3],a[4]]}},{re:/#([a-fA-F0-9]{2})([a-fA-F0-9]{2})([a-fA-F0-9]{2})/,parse:function(a){return[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]}},{re:/#([a-fA-F0-9])([a-fA-F0-9])([a-fA-F0-9])/,parse:function(a){return[parseInt(a[1]+a[1],16),parseInt(a[2]+a[2],16),parseInt(a[3]+a[3],16)]}}]}}).factory("Color",["helper",function(a){return{value:{h:1,s:1,b:1,a:1},rgb:function(){var a=this.toRGB();return"rgb("+a.r+","+a.g+","+a.b+")"},rgba:function(){var a=this.toRGB();return"rgba("+a.r+","+a.g+","+a.b+","+a.a+")"},hex:function(){return this.toHex()},RGBtoHSB:function(a,b,c,d){a/=255,b/=255,c/=255;var e,f,g,h;return g=Math.max(a,b,c),h=g-Math.min(a,b,c),e=0===h?null:g==a?(b-c)/h:g==b?(c-a)/h+2:(a-b)/h+4,e=(e+360)%6*60/360,f=0===h?0:h/g,{h:e||1,s:f,b:g,a:d||1}},HueToRGB:function(a,b,c){return 0>c?c+=1:c>1&&(c-=1),1>6*c?a+(b-a)*c*6:1>2*c?b:2>3*c?a+(b-a)*(2/3-c)*6:a},setColor:function(b){b=b.toLowerCase();for(var c in a.stringParsers){{var d=a.stringParsers[c],e=d.re.exec(b),f=e&&d.parse(e);d.space||"rgba"}if(f)return this.value=this.RGBtoHSB.apply(null,f),!1}},setHue:function(a){this.value.h=1-a},setSaturation:function(a){this.value.s=a},setLightness:function(a){this.value.b=1-a},setAlpha:function(a){this.value.a=parseInt(100*(1-a),10)/100},toRGB:function(a,b,c,d){a||(a=this.value.h,b=this.value.s,c=this.value.b),a*=360;var e,f,g,h,i;return a=a%360/60,i=c*b,h=i*(1-Math.abs(a%2-1)),e=f=g=c-i,a=~~a,e+=[i,h,0,0,h,i][a],f+=[h,i,i,h,0,0][a],g+=[0,0,h,i,i,h][a],{r:Math.round(255*e),g:Math.round(255*f),b:Math.round(255*g),a:d||this.value.a}},toHex:function(a,b,c,d){var e=this.toRGB(a,b,c,d);return"#"+(1<<24|parseInt(e.r)<<16|parseInt(e.g)<<8|parseInt(e.b)).toString(16).substr(1)}}}]).directive("colorpicker",["$document","$compile","Color","helper","$timeout","$rootScope",function(a,b,c,d,e,f){return{require:"?ngModel",restrict:"A",link:function(g,h,i,j){var k,l,m,n,o,p='<div class="colorpicker dropdown-menu"><div class="clickarea"><div class="colorpicker-saturation"><i><b></b></i></div><div class="colorpicker-hue"><i></i></div><div class="colorpicker-alpha"><i></i></div><div class="colorpicker-color"><div /></div></div><div class="colorpicker-color-value"><div /><input value="{{model}}" /></div></div>',q=angular.element(p),r=c,s=null,t=null,u=i.colorpicker?i.colorpicker:"hex";b(q)(g),l={enabled:"rgba"===u,css:null},l.enabled===!0&&(q.addClass("alpha"),l.css=q.find("div")[2].style),angular.element(document.body).append(q),j&&(j.$render=function(){h.val(j.$viewValue)},g.$watch(i.ngModel,function(){z()})),g.$on("$destroy",function(){q.remove()}),m=q.find(".clickarea div")[0].style,k=q.find(".clickarea div")[4].style,n=q.find("i"),o=q.find("input");var v=function(){try{k.backgroundColor=r[u]()}catch(a){k.backgroundColor=r.toHex()}m.backgroundColor=r.toHex(r.value.h,1,1,1),l.enabled===!0&&(l.css.backgroundColor=r.toHex())},w=function(a){a.stopPropagation(),a.preventDefault();var b=d.closest(a.target,"div");if("colorpicker-saturation"===b.className)t=d.extend({},{maxLeft:100,maxTop:100,callLeft:"setSaturation",callTop:"setLightness"});else if("colorpicker-hue"===b.className)t=d.extend({},{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setHue"});else{if("colorpicker-alpha"!==b.className)return!1;t=d.extend({},{maxLeft:0,maxTop:100,callLeft:!1,callTop:"setAlpha"})}t.knob=b.children[0].style,t.left=a.pageX-d.getOffset(b).left,t.top=a.pageY-d.getOffset(b).top,s={left:a.pageX,top:a.pageY}},x=function(a){var b=Math.max(0,Math.min(t.maxLeft,t.left+((a.pageX||s.left)-s.left))),c=Math.max(0,Math.min(t.maxTop,t.top+((a.pageY||s.top)-s.top)));t.knob.left=b+"px",t.knob.top=c+"px",t.callLeft&&r[t.callLeft].call(r,b/100),t.callTop&&r[t.callTop].call(r,c/100),v();var d=r[u]();return h.val(d),j&&g.$apply(j.$setViewValue(d)),!1},y=function(){a.unbind("mousemove",x),a.unbind("mouseup",y)},z=function(a){a&&h.val(a),r.setColor(h.val()),n.eq(0).css({left:100*r.value.s+"px",top:100-100*r.value.b+"px"}),n.eq(1).css("top",100*(1-r.value.h)+"px"),n.eq(2).css("top",100*(1-r.value.a)+"px"),v(),o.val(r[u]())};h.bind("click",function(){z(),q.addClass("colorpicker-visible").css({top:d.getOffset($(h).next()[0]).top+$(h).next()[0].offsetHeight-document.body.scrollTop+"px",left:d.getOffset($(h).next()[0]).left-document.body.scrollLeft+"px"})}),q.bind("mousedown",function(a){$(a.target).is(".colorpicker-color-value input")||(a.stopPropagation(),a.preventDefault())});var A;o.bind("keyup",function(){var a=o.val(),b=r.setColor(a);A&&e.cancel(A),A=e(function(){"undefined"!=typeof b&&z(a)},500)}),q.find(".clickarea div").bind("click",function(a){w(a),x(a)}),q.find(".clickarea div").bind("mousedown",function(b){w(b),a.bind("mousemove",x),a.bind("mouseup",y)}),a.bind("mousedown",function(a){$(a.target).is(".colorpicker-color-value input")||q.hasClass("colorpicker-visible")&&(q.removeClass("colorpicker-visible"),f.$broadcast("colorPickerClosed"))})}}}]);