/*! Studio-v2 - v2.0.0 - 2013-12-22
* https://github.com/kaltura/player-studio
* Copyright (c) 2013 Kaltura */
"use strict";var cl=function(a){return console.log(a)};window.lang="en-US";var KMCModule=angular.module("KMCModule",["localization","ngRoute","KMC.controllers","KMC.filters","KMC.services","KMC.directives","ui.bootstrap","ngAnimate","LocalStorageModule","KMC.menu"]);KMCModule.config(["$routeProvider","$locationProvider","$httpProvider","$tooltipProvider",function(a,b,c,d){d.options({placement:"right",appendToBody:!0,popupDelay:800}),c.defaults.useXDomain=!0,delete c.defaults.headers.common["X-Requested-With"];var e,f=["$q","$injector",function(a,b){function c(a){return e=e||b.get("$http"),e.pendingRequests.length<1&&(f=f||b.get("requestNotificationChannel"),f.requestEnded()),a}function d(c){return e=e||b.get("$http"),e.pendingRequests.length<1&&(f=f||b.get("requestNotificationChannel"),f.requestEnded()),a.reject(c)}var f;return function(a){return f=f||b.get("requestNotificationChannel"),f.requestStarted(),a.then(c,d)}}];c.responseInterceptors.push(f),b.html5Mode(!0),a.when("/login",{templateUrl:"view/login.html",controller:"LoginCtrl",resolve:{apiService:["apiService",function(a){return a}],localize:"localize"}}),a.when("/list",{templateUrl:"view/list.html",controller:"PlayerListCtrl",resolve:{apiService:["apiService","localStorageService","$location",function(a,b,c){return g(a,b,c)}]}});var g=function(a,b,c){var d=b.get("ks");return d?(a.setKs(d),a):(c.path("/login"),!1)};a.when("/edit/:id",{templateUrl:"view/edit.html",controller:"PlayerEditCtrl",resolve:{PlayerData:["PlayerService","$route","apiService","localStorageService","$location",function(a,b,c,d,e){return g(c,d,e),a.getPlayer(b.current.params.id)}],editProperties:"editableProperties",menuSvc:"menuSvc",localize:"localize",userEntries:["apiService","localStorageService","$location",function(a,b,c){return g(a,b,c),a.listMedia()}]}}),a.when("/newByTemplate",{templateUrl:"view/new-template.html",controller:"PlayerCreateCtrl",resolve:{templates:["playerTemplates",function(a){return a.listSystem()}],userId:function(){return"1"}}}),a.when("/new",{templateUrl:"view/edit.html",controller:"PlayerEditCtrl",resolve:{PlayerData:["PlayerService","apiService","localStorageService","$location",function(a,b,c,d){return g(b,c,d),a.newPlayer()}],editProperties:"editableProperties",menuSvc:"menuSvc",localize:"localize",userEntries:["apiService","localStorageService","$location",function(a,b,c){return g(a,b,c),a.listMedia()}]}}),a.when("/logout",{resolve:{logout:["localStorageService","apiService","$location",function(a,b,c){a.isSupported()&&a.clearAll(),b.unSetks(),c.path("/login")}]}}),a.otherwise({resolve:{res:["localStorageService","$location",function(a,b){parent.kmc&&parent.kmc.vars&&parent.kmc.vars.ks&&a.add("ks",parent.kmc.vars.ks);var c=a.get("ks");return c?b.path("/list"):b.path("/login")}]}})}]);var DirectivesModule=angular.module("KMC.directives",["colorpicker.module","ui.select2","ui.sortable"]);DirectivesModule.directive("mcustomScrollbar",["$timeout",function(a){return{priority:0,restrict:"AC",controller:["$scope","$element","$attrs",function(b){b.$on("layoutChange",function(){b.scroller&&a(function(){b.scroller.mCustomScrollbar("update")},500)})}],link:function(b,c,d){var e=b.$eval(d.mcustomScrollbar),f={horizontalScroll:!1,mouseWheel:!0,autoHideScrollbar:!0,contentTouchScroll:!0,theme:"dark",advanced:{updateOnBrowserResize:!0,updateOnContentResize:!0}};angular.extend(f,e),a(function(){"function"==typeof $().mCustomScrollbar&&(b.scroller=c.mCustomScrollbar(f))},500)}}}]),DirectivesModule.directive("timeago",[function(){return{scope:{timestamp:"@"},restrict:"CA",link:function(a,b){"function"==typeof $.timeago&&a.$watch("timestamp",function(c){if(c){var d=1e3*a.timestamp;b.text($.timeago(d))}})}}}]),DirectivesModule.directive("modelRadio",["menuSvc",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/formcontrols/modelRadio.html",scope:{model:"=",label:"@",helpnote:"@"},controller:["$scope","$element","$attrs",function(b,c,d){var e=a.getControlData(d.model);b.options=e.options}],link:function(a,b){b.find("input").attr("name",a.model)}}}]),DirectivesModule.directive("modelColor",function(){return{restrict:"EA",replace:!0,controller:["$scope","$element","$attrs",function(a,b,c){"undefined"==typeof a.model&&(a.model=c.initvalue?c.initvalue:"#fff")}],scope:{"class":"@",label:"@",helpnote:"@",model:"="},templateUrl:"template/formcontrols/modalColor.html"}}),DirectivesModule.directive("modelText",function(){return{replace:!0,restrict:"EA",scope:{label:"@",model:"=",icon:"@",helpnote:"@"},compile:function(a,b){"true"==b.endline&&a.append("<hr/>")},templateUrl:"template/formcontrols/modalText.html"}}),DirectivesModule.directive("select2Data",["menuSvc",function(a){return{replace:!0,restrict:"EA",scope:{label:"@",model:"=",icon:"@",helpnote:"@",initvalue:"@"},controller:["$scope","$element","$attrs",function(b,c,d){b.selectOpts={},b.selectOpts.data=a.doAction(d.source),d.query&&(b.selectOpts.data.results=[],b.selectOpts.query=a.getAction(d.query)),b.selectOpts.width=d.width}],templateUrl:"template/formcontrols/select2Data.html",compile:function(a,b){return"true"==b.endline&&a.append("<hr/>"),"true"==b.showEntriesThumbs&&a.find("input").attr("list-entries-thumbs","true"),b.placeholder&&a.find("input").attr("data-placeholder",b.placeholder),function(){}}}}]),DirectivesModule.directive("modelEdit",["$modal",function(a){var b=["$scope",function(a){"undefined"==typeof a.model&&(a.model=""),a.modelValue=a.model}];return{replace:!0,restrict:"EA",scope:{label:"@",helpnote:"@",model:"=",icon:"@"},controller:b,templateUrl:"template/formcontrols/modelEdit.html",compile:function(b,c){return"true"==c.endline&&b.append("<hr/>"),function(b,c,d){b.doModal=function(){var c=a.open({templateUrl:"template/dialog/textarea.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{close:function(a,d){b.model=d,c.close(a)},title:d.label,message:b.model}}}})}}}}}]),DirectivesModule.directive("modelTags",["menuSvc",function(a){return{replace:!0,restrict:"EA",scope:{label:"@",model:"=",helpnote:"@",icon:"@"},controller:["$scope","$element","$attrs",function(b,c,d){b.selectOpts={simple_tags:!0,multiple:!0,tokenSeparators:[","," "]},b.selectOpts.tags=a.doAction(d.source)}],templateUrl:"template/formcontrols/modelTags.html",compile:function(a,b){return"true"==b.endline&&a.append("<hr/>"),function(){}}}}]),DirectivesModule.directive("listEntriesThumbs",function(){return{restrict:"A",controller:["$scope","$element","$attrs",function(a,b,c){if("true"==c.listEntriesThumbs){var d=function(a){return a.thumbnailUrl?"<img class='thumb' src='"+a.thumbnailUrl+"'/>"+a.name:a.name};a.addOption({formatResult:d,formatSelection:d,escapeMarkup:function(a){return a}})}}]}}),DirectivesModule.directive("modelSelect",["menuSvc",function(a){return{replace:!0,restrict:"EA",require:"?parentContainer",scope:{label:"@",model:"=",initvalue:"@",helpnote:"@",selectOpts:"@"},compile:function(b,c){return"true"==c.endline&&b.append("<hr/>"),function(b,c,d,e){if(e){var f={model:d.model,label:d.label.replace("Location",""),sortVal:a.getControlData(d.model).sortVal};e.register(b.model,f),b.$watch("model",function(a,b){a!=b&&e.update(a,b,f)})}var g=a.getControlData(d.model);b.options=g.options}},controller:["$scope","$element","$attrs",function(a,b,c){a.selectOpts||(a.selectOpts={}),c.showSearch||(a.selectOpts.minimumResultsForSearch=-1),a.options=[],a.checkSelection=function(b){return b==a.model?!0:"number"==typeof b&&parseFloat(a.model)==b?!0:!1},a.initSelection=function(){return(""==a.model||"undefined"==typeof a.model)&&(a.model=c.initvalue),a.model},a.selectOpts.initSelection=a.initSelection(),a.uiselectOpts=angular.toJson(a.selectOpts),this.setOptions=function(b){a.options=b}}],templateUrl:"template/formcontrols/modelSelect.html"}}]),DirectivesModule.directive("parentContainer",["sortSvc",function(a){return{restrict:"A",controller:function(){var b={register:function(b,c){a.register(b,c)},update:function(b,c,d){a.update(b,c,d)}};return b}}}]),DirectivesModule.directive("sortOrder",["sortSvc",function(a){return{restrict:"EA",replace:!0,scope:{},templateUrl:"template/formcontrols/sortOrder.html",controller:["$scope",function(b){b.getObjects=function(){b.containers=a.getObjects()},b.getObjects(),a.sortScope=b,b.$on("sortContainersChanged",function(){b.getObjects()}),b.$watchCollection("containers",function(c,d){c!=d&&a.saveOrder(b.containers)}),b.sortableOptions={update:function(){cl(b.containers)},axis:"y"}}],link:function(){}}}]),DirectivesModule.directive("playerRefresh",["PlayerService","menuSvc",function(a,b){return{restrict:"A",link:function(c,d,e){if("false"!=e.playerRefresh){var f=e.model;b.menuScope.$watch(f,function(){a.playerRefresh(e.playerRefresh)})}}}}]),DirectivesModule.directive("infoAction",["menuSvc",function(a){return{restrict:"EA",replace:"true",controller:["$scope",function(b){b.check=function(b){return a.checkAction(b)},b.btnAction=function(b){a.doAction(b)}}],scope:{model:"=",btnLabel:"@",btnClass:"@",action:"@",helpnote:"@",label:"@"},templateUrl:"template/formcontrols/infoAction.html"}}]),DirectivesModule.directive("prettyCheckbox",function(){return{restrict:"AC",require:"ngModel",transclude:"element",compile:function(a,b,c){return function(a,b,d,e){var f=angular.element('<div class="prettycheckbox"></div>'),g=f.append('<a href="#" class=""></a>');c(a,function(a){return b.replaceWith(f).append(a)});var h=(f.find("input").hide(),d.model||"model");f.on("click","a",function(a){return a.preventDefault(),e.$setViewValue(!e.$viewValue),!1});var i=function(){e.$viewValue?$(f).find("a").addClass("checked"):$(f).find("a").removeClass("checked")};e.$viewChangeListeners.push(i),a.$eval(h)&&g.find("a").addClass("checked")}}}}),DirectivesModule.directive("prettyRadio",function(){return{restrict:"AC",priority:1e3,transclude:"element",compile:function(a,b,c){return function(a,b,d){var e=angular.element('<span class="clearfix prettyradio"></span>'),f=e.append('<a href="#" class=""></a>'),g="model";"undefined"!=typeof d.model&&(g=d.model),c(a,function(a){return e.append(a)}),b.replaceWith(e);var h=e.find("input").hide();f.on("click","a",function(a){return a.preventDefault(),h.trigger("click"),h.trigger("click"),!1}),a.$watch(function(){return a.$eval(g)==h.val()},function(a,b){a!=b&&$(e).find("a").toggleClass("checked")})}}}}),DirectivesModule.directive("modelCheckbox",function(){return{restrict:"EA",templateUrl:"template/formcontrols/modelCheckbox.html",replace:!0,controller:["$scope","$element","$attrs",function(a,b,c){(""==a.model||"undefined"==typeof a.model)&&"true"===c.initvalue&&(a.model=!0)}],scope:{label:"@",helpnote:"@",model:"="}}}),DirectivesModule.directive("readOnly",["$filter",function(a){return{restrict:"EA",replace:"true",scope:{model:"=",label:"@",helpnote:"@"},controller:["$scope","$element","$attrs",function(b,c,d){d.filter&&"function"==typeof a(d.filter)&&(b.model=a(d.filter)(b.model)),d.initvalue&&("undefined"==typeof b.model||""==scope.model)&&(b.model=d.initvalue)}],templateUrl:"template/formcontrols/readOnly.html"}}]),DirectivesModule.directive("modelButton",["menuSvc",function(a){return{restrict:"EA",replace:"true",controller:["$scope",function(b){b.check=function(b){return a.checkAction(b)},b.btnAction=function(b){a.doAction(b)}}],scope:{label:"@",action:"@",btnClass:"@",helpnote:"@"},templateUrl:"template/formcontrols/modelButton.html"}}]),DirectivesModule.directive("modelNumber",function(){return{templateUrl:"template/formcontrols/spinEdit.html",replace:!0,restrict:"EA",scope:{model:"=",helpnote:"@",label:"@"},link:function(a,b,c){var d=b.find("input").spinedit({minimum:parseFloat(c.from),maximum:parseFloat(c.to),step:parseFloat(c.stepsize),value:parseFloat(c.initvalue),numberOfDecimals:parseFloat(c.numberofdecimals)});d.on("valueChanged",function(b){"number"==typeof b.value&&a.$apply(function(){a.model=b.value})})},controller:["$scope","$element","$attrs",function(a,b,c){var d={from:5,to:10,stepsize:1,numberOfDecimals:0},e=["from","to","stepsize","numberofdecimals"];angular.forEach(e,function(b){a[b]=c[b]?c[b]:d[b]}),a.initvalue="undefined"!=typeof a.model?a.model:c["default"]?c["default"]:1}]}}),DirectivesModule.directive("onFinishRender",["$timeout","requestNotificationChannel",function(a,b){return{restrict:"A",link:function(c){c.$last===!0&&a(function(){b.requestEnded("list")})}}}]),angular.module("KMC.filters",["ngSanitize"]).filter("HTMLunsafe",["$sce",function(a){return function(b){return a.trustAsHtml(b)}}]).filter("timeago",function(){return function(a){if("function"==typeof $.timeago){var b=1e3*a;return $.timeago(b)}}}).filter("range",function(){return function(a){var b,c;switch(a.length){case 1:b=0,c=parseInt(a[0])-1;break;case 2:b=parseInt(a[0]),c=parseInt(a[1]);break;default:return a}for(var d=[],e=b;c>=e;e++)d.push(e);return d}}).filter("startFrom",function(){return function(a,b){return a?(b=+b,a.slice(b)):[]}});var KMCMenu=angular.module("KMC.menu",[]);KMCMenu.controller("menuCntrl",["menuSvc","$scope",function(a,b){var c=function(){return $("#mp-menu").width()},d=function(){var a=c();$("#mp-pusher").animate({left:"0"},{duration:200,queue:!0}),$("#mp-menu").animate({left:"-"+a}),$("#mp-pusher >.wrapper").animate({width:"100%"})},e=function(){var a=c();$("#mp-pusher").css({left:a}),$("#mp-menu").css({left:-a})},f=function(){var a=c();$("#mp-pusher").animate({left:a},{duration:200,queue:!0}),$("#mp-menu").animate({left:-a},{duration:200,queue:!1}),$("#mp-pusher >.wrapper").animate({width:"70%"},{duration:200,queue:!0})};b.menuShown=!0,e(),$(window).resize(function(){1==b.menuShown?e():d()}),b.$on("menuChange",function(){b.menuShown=!0}),b.$watch(function(){return a.currentPage},function(a,c){a!=c&&(b.menuShown||(b.menuShown=!0))}),b.togglemenu=function(a){b.menuShown=!b.menuShown,b.menuShown?$(a.target).parent().css("transform",""):$(a.target).parent().css("transform","rotate(180deg)")},b.$watch("menuShown",function(a,b){a!=b&&(a?f():d())})}]),KMCMenu.factory("menuSvc",["editableProperties",function(editableProperties){var menudata=null,promise=editableProperties.success(function(a){menudata=a}),JSON2directiveDictionary=function(a){switch(a){case"modaledit":return"<div model-edit/>";case"tags":return"<div model-tags/>";case"select2data":return"<div select2-data/>";case"dropdown":return"<div model-select/>";case"container":return'<div model-select parent-container=""/>';case"checkbox":return"<div model-checkbox/>";case"color":return"<div model-color/>";case"text":return"<div model-text/>";case"number":return"<div model-number/>";case"readonly":return"<div read-only/>";case"featuremenu":return"<div feature-menu/>";case"radio":return"<div model-radio/>";case"button":return"<div model-button/>";case"infoAction":return"<div info-action/>";case"sortOrder":return"<div sort-order/>"}},searchGet=function(a,b){return"undefined"!=typeof a[b]?a[b]:void 0},search=function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)&&("label"==d||"children"==d||"object"==typeof b[d])){if(b[d]==c)return a+"['"+d+"']";if("object"==typeof b[d]||"Array"==typeof b[d]){var e=search(a+"['"+d+"']",b[d],c);if(e)return e}}return!1},Search4ControlModelData=function(a,b,c){for(var d in b)if(b.hasOwnProperty(d)&&("label"==d||"children"==d||"object"==typeof b[d])){if("undefined"!=typeof b[d].model&&b[d].model==c)return b[d];if("object"==typeof b[d]){var e=Search4ControlModelData(a+"['"+d+"']",b[d],c);if(e)return e}}return!1},menuSvc={promise:promise,menuScope:{},get:function(){return menudata},getModalData:function(a){return searchGet(menuSvc.menuScope,a)},getControlData:function(a){var b=a.substr(a.indexOf(".")+1);return Search4ControlModelData("",menudata,b)},currentPage:"",setMenu:function(a){menuSvc.currentPage=a,menuSvc.menuScope.$parent.$broadcast("menuChange",a)},buildMenu:function(a){var b=menuSvc.get(),c=angular.element("<ul></ul>");return angular.forEach(b,function(b){c.append(menuSvc.buildMenuItem(b,c,a))}),c},buildMenuItem:function(a,b,c,d){function e(a,b,c){for(var d=0;d<a.children.length;d++){var g=a.children[d];switch(g.type){case"menu":b.append(menuSvc.buildMenuItem(g,b,a.model,a));break;case"featuremenu":b.append(e(g,f(g,"<div feature-menu/>")));break;default:var h=JSON2directiveDictionary(g.type);h&&b.append(f(g,h))}}return 1==c&&b.children().each(function(){$(this).is("menu-level")||$(this).wrap("<li>")}),b}function f(a,b){var c=angular.element(b);return c.attr("model","data."+a.model),angular.forEach(a,function(a,b){"model"==b||"string"!=typeof a&&"number"!=typeof a&&"boolean"!=typeof a||c.attr(b,a)}),c}var g="";switch(a.type){case"menu":var h=angular.element('<div menu-level pagename="'+a.model+'" />');"undefined"!=typeof d&&(h.attr("parent-label",d.label),h.attr("parent-page",d.model));var i=f(a,h);g=e(a,i,!0);break;case"featuremenu":g=e(a,f(a,"<div feature-menu/>"));break;default:var j=JSON2directiveDictionary(a.type);j&&(g=f(a,j))}return g},menuSearch:function(searchValue){var foundLabel=search("menudata",menudata,searchValue);if(!foundLabel)return!1;var foundModel=eval(foundLabel.substr(0,foundLabel.lastIndexOf("['label']"))).model,lastChild=foundLabel.lastIndexOf("['children']"),lastMenu=foundLabel.substr(0,lastChild),menuPage=eval(lastMenu),featureMenu=[];if("object"==typeof menuPage){if("featuremenu"==menuPage.type)for(;"object"==typeof menuPage&&"featuremenu"==menuPage.type;)featureMenu.push(menuPage),lastChild=lastMenu.lastIndexOf("['children']"),menuPage=eval(lastMenu.substr(0,lastChild)),lastMenu=foundLabel.substr(0,lastChild);return menuSvc.menuScope.$broadcast("highlight",foundModel),menuSvc.setMenu(menuPage.model),featureMenu.length&&angular.forEach(featureMenu,function(a){menuSvc.menuScope.$broadcast("openFeature",a.model)}),!0}},actions:[],registerAction:function(a,b,c){"function"==typeof b?menuSvc.actions[a]=c?{applyOn:c,funcData:b}:b:"object"==typeof b&&(menuSvc.actions[a]={applyOn:b,funcData:function(){return b}})},doAction:function(a,b){if("function"==typeof menuSvc.actions[a])return menuSvc.actions[a].call(b);if("object"==typeof menuSvc.actions[a]&&"function"==typeof menuSvc.actions[a].funcData){var c=menuSvc.actions[a].funcData.apply(menuSvc.actions[a].applyOn,b);return c}},getAction:function(a){return menuSvc.actions[a]},checkAction:function(a){return"function"==typeof menuSvc.actions[a]?!0:!1}};return menuSvc}]).directive("featureMenu",["$parse",function(a){return{restrict:"EA",replace:!0,templateUrl:"template/menu/featureMenu.html",transclude:!0,controller:["$scope","$element","$attrs",function(b,c,d){b.label=d.label,b.helpnote=d.helpnote,b.featureCheckbox="false"==d.featureCheckbox?!1:!0,b.featureCheckbox&&(b.modelPath=d.model+"._featureEnabled",b.featureModelCon=a(b.modelPath),b.featureModel=b.featureModelCon(b)),b.id=d.model.replace(/\./g,"_")}],scope:!0,compile:function(a,b,c){return"false"!=b.endline&&a.append("<hr/>"),function(a,b,d){a.$watch("featureModel",function(c,d){c!=d&&(a.featureModelCon.assign(a,c),c&&b.find(".collapse").length>0&&b.find("#"+a.id).collapse("toggle"))}),c(a,function(a){b.find("ng-transclude").replaceWith(a)}),b.on("show.bs.collapse hide.bs.collapse",function(b){b.target.id==a.id&&$(this).find(".header:first i.glyphicon").toggleClass("rotate90")}),a.$on("openFeature",function(c,e){e==d.highlight&&b.find("#"+a.id).collapse("show")})}}}}]).directive("model",["$timeout",function(a){return{restrict:"A",link:function(b,c,d){b.$on("highlight",function(b,e){if(d.model.replace("data.","")==e){var f=c;c.parent().is("li")&&(f=c.parent());var g=f.css("background")||"transparent";f.css({backgroundColor:"rgba(253,255,187,1)"}),a(function(){f.animate({backgroundColor:"rgba(253,255,187,0)"},1e3,function(){f.css({backgroundColor:g},1e3)})},4e3)}})}}}]).directive("navmenu",["menuSvc","$compile","$timeout",function(a,b,c){return{templateUrl:"template/menu/navmenu.html",replace:!0,restrict:"EA",scope:{data:"="},transclude:!0,compile:function(d){var e=d.find("ul[ng-transclude]:first"),f=a.buildMenu("data");return function(d,g){b(f.contents())(d,function(a){e.prepend(a)}),d.$on("menuChange",function(a,b){g.find(".mCustomScrollbar").mCustomScrollbar("destroy"),"search"!=b&&c(function(){g.find(".mp-level-open:last").mCustomScrollbar({set_height:"100%"})},500)}),c(function(){a.setMenu("basicDisplay")},500)}},controller:["$scope","$element",function(b,c){c.on("shown.bs.collapse hidden.bs.collapse",function(){$(".mCustomScrollbar").mCustomScrollbar("update")}),a.menuScope=b}]}}]).controller("menuSearchCtl",["$scope","menuSvc",function(a,b){var c=b.get();a.menuData=[],a.checkSearch=function(b){b&&console.log(b),a.notFound=!1,a.menuSearch&&a.searchMenuFn()},a.menuSearch="",a.searchMenuFn=function(){var c=b.menuSearch(a.menuSearch);c?a.menuSearch="":a.notFound=!0};var d=function(b){angular.forEach(b,function(b){a.menuData.push(b.label),b.children&&d(b.children)})};d(c)}]).directive("menuLevel",["menuSvc",function(a){return{templateUrl:"template/menu/menuPage.html",replace:!0,transclude:"true",restrict:"EA",controller:["$scope","$element","$attrs",function(b,c,d){b.selfOpenLevel=function(){a.setMenu(d.pagename)},b.goBack=function(){a.setMenu(d.parentPage)},b.openLevel=function(a){return b.isOnTop="undefined"==typeof a?!0:a==b.pagename?!0:!1},b.isOnTop=!1}],compile:function(a,b){return"true"==b.endline&&a.find("div.menu-level-trigger").append("<hr/>"),function(a,b){a.$on("menuChange",function(b,c){a.openLevel(c)}),a.$watch("isOnTop",function(a){a?(b.parents('.mp-level:not("#mp-base")').addClass("mp-level-in-stack"),b.children(".mp-level:first").addClass("mp-level-open").removeClass("mp-level-in-stack")):(b.children(".mp-level:first").removeClass("mp-level-open"),b.parents('.mp-level.mp-level-in-stack:not("#mp-base")').removeClass("mp-level-open mp-level-in-stack"))})}},scope:{label:"@",pagename:"@",parentPage:"@",parentLabel:"@",description:"@"}}}]).directive("menuHead",["menuSvc",function(a){return{restrict:"EA",template:"<div id='mp-mainlevel'><ul></ul></div>",replace:!0,transclude:!0,scope:{},controller:["$scope","$element",function(a){a.changeActiveItem=function(a){var b=$(a);b.length&&b.is("a")&&b.parent("li")&&($(b).addClass("active"),$(b).parent("li").siblings("li").find("a").removeClass("active"))}}],compile:function(b,c,d){var e=b.find("ul"),f=a.get();return angular.forEach(f,function(a,b){var c=angular.element("<li></li>");c.html('<a menupage="'+a.model+'" class="icon icon-'+a.icon+'" tooltip-placement="right" tooltip="'+a.label+'"></a>'),0==b&&c.find("a").addClass("active"),c.appendTo(e)}),function(b,c){d(b,function(a){e.prepend(a)}),c.find("a[menupage]").each(function(){$(this).click(function(){var c=$(this).attr("menupage");a.setMenu(c),b.changeActiveItem(this)})})}}}}]),KMCModule.controller("LoginCtrl",["$scope","apiService","$location","localStorageService","requestNotificationChannel",function(a,b,c,d,e){e.requestEnded("list"),a.formError=!0,a.formHelpMsg="You must login to use this application",a.email="",a.pwd="",a.login=function(){b.doRequest({service:"user",action:"loginbyloginid",loginId:a.email,password:a.pwd}).then(function(a){d.isSupported()&&d.add("ks",a),b.setKs(a),c.path("/list")},function(b){a.formError=!0,a.formHelpMsg=b})}}]),angular.module("KMC.controllers",[]).controller("ModalInstanceCtrl",["$scope","$modalInstance","settings",function(a,b,c){a.title="",a.message="",a.buttons=[{result:!1,label:"Cancel",cssClass:"btn-default"},{result:!0,label:"OK",cssClass:"btn-primary"}],a.close=function(a){b.close(a)},a.cancel=function(){b.dismiss("cancel")},angular.extend(a,c)}]),KMCModule.controller("PlayerCreateCtrl",["$scope","$filter","templates","userId","playerTemplates",function(a,b,c,d,e){a.title=b("i18n")("New player - from template"),a.templates=c.data,a.templateType="system",a.userId=d,a.loading=!1,a.$watch("templateType",function(b,d){b!=d&&("user"==b?(a.loading=!0,e.listUser(a.userID).success(function(b){a.templates=b,a.loading=!1})):(a.loading=!0,a.templates=c.data,a.loading=!1))}),a.makeTooltip=function(b){var c=a.templates[b];return c&&"undefined"!=typeof c.settings&&"undefined"!=typeof c.settings.name?c.settings.name+"<br/>"+c.id+"<br/> Any information you will decide to show":void 0}}]),KMCModule.controller("PlayerEditCtrl",["$scope","PlayerData","$routeParams","$filter","menuSvc","PlayerService","apiService","localStorageService","userEntries",function(a,b,c,d,e,f,g,h,i){if(a.ks=h.get("ks"),a.playerId=b.id,a.title=c.id?d("i18n")("Edit player"):d("i18n")("New  player"),a.data=b,a.userEntriesList=[],a.userEntries=i,a.tags=[],"undefined"!=typeof a.data.tags&&a.data.tags)for(var j="string"==typeof a.data.tags?a.data.tags.split(","):a.data.tags,k=0;k<j.length;k++)a.tags.push({id:j[k],text:j[k]});e.registerAction("getTags",function(){return a.tags}),angular.forEach(a.userEntries.objects,function(b){a.userEntriesList.push({id:b.id,text:b.name})}),e.registerAction("listEntries",function(){return a.userEntriesList}),e.registerAction("queryEntries",function(b){var c={results:[]};return console.log(b.term),b.term?(angular.forEach(a.userEntriesList,function(a){b.term.toUpperCase()===a.text.substring(0,b.term.length).toUpperCase()&&c.results.push(a)}),b.callback(c)):b.callback({results:a.userEntriesList})}),parseFloat(a.data.version)<f.getRequiredVersion()&&e.registerAction("update",function(){f.playerUpdate(a.data)}),a.previewEntry=a.data.previewentry?a.data.previewentry.id:"0_ji4qh61l",a.$watch("data.previewentry",function(b,c){b!=c&&(a.previewEntry=b.id,f.setPreviewEntry(a.previewEntry),f.renderPlayer())}),$(document).ready(function(){f.setPreviewEntry(a.previewEntry),f.renderPlayer()})}]),KMCModule.controller("editPageDataCntrl",["$scope",function(){}]),KMCModule.controller("PlayerListCtrl",["apiService","$location","$rootScope","$scope","$filter","$modal","$timeout","$log","$compile","$window","localStorageService","requestNotificationChannel","PlayerService",function(a,b,c,d,e,f,g,h,i,j,k,l,m){l.requestStarted("list"),c.lang="en-US",d.search="",d.searchSelect2Options={},d.currentPage=1,d.maxSize=5;var n={"filter:tagsMultiLikeOr":"kdp3","filter:orderBy":"-updatedAt","filter:objTypeEqual":"1","filter:objectType":"KalturaUiConfFilter","filter:creationModeEqual":"2",ignoreNull:"1","page:objectType":"KalturaFilterPager","pager:pageIndex":"1","pager:pageSize":"25",service:"uiConf",action:"list"};a.doRequest(n).then(function(a){d.data=a.objects,d.calculateTotalItems(),m.cachePlayers(a.objects)}),d.filtered=e("filter")(d.data,d.search)||[],d.playerVersions=[{label:"1.0",url:"",value:"1.0"},{label:"2.0",url:"",value:"2.0"},{label:"2.0.1rc2",url:"",value:"2.0.1"}],d.requiredVersion="201",d.calculateTotalItems=function(){if(d.filtered)d.totalItems=d.filtered.length;else if(d.data)return d.totalItems=d.data.length,d.totalItems},d.checkVersionNeedsUpgrade=function(a){return a?(a=a.replace(/\./g,""),a>=d.requiredVersion?!1:!0):!1},d.showSubTitle=!0,d.getThumbnail=function(a){return"undefined"!=typeof a.thumbnailUrl?a.thumbnailUrl:d.defaultThumbnailUrl},d.defaultThumbnailUrl="img/mockPlayerThumb.png",d.$watch("search",function(a,b){d.showSubTitle=a,a.length>0?d.title=e("i18n")("search for")+' "'+a+'"':b&&(d.title=e("i18n")("Players list")),g(function(){d.calculateTotalItems()},100)}),d.oldVersionEditText=e("i18n")("Warning this player is out of date. \nSaving changes to this player upgrade, some features and \ndesign may be lost. (read more about upgrading players)"),d.goToEditPage=function(a,c){if(c.preventDefault(),!d.checkVersionNeedsUpgrade(a.version))return b.path("/edit/"+a.id),!1;var e=d.oldVersionEditText,g=f.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Edit confirmation",message:e}}}});g.result.then(function(c){return c?b.url("edit/"+a.id):void 0},function(){return h.info("edit when outdated modal dismissed at: "+new Date)})},d.newPlayer=function(){b.path("/new")},d.duplicate=function(a){d.data.splice(d.data.indexOf(a)+1,0,a)},d.deletePlayer=function(a){var b=f.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Delete confirmation",message:"Are you sure you want to delete the player?"}}}});b.result.then(function(b){b&&m.deletePlayer(a.id).then(function(){d.data.splice(d.data.indexOf(a),1)},function(a){f.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Delete failure",message:a}}}})})},function(){h.info("Delete modal dismissed at: "+new Date)})},d.update=function(a){m.playerUpdate(a)}}]);var KMCServices=angular.module("KMC.services",[]);KMCServices.config(["$httpProvider",function(a){a.defaults.useXDomain=!0,delete a.defaults.headers.common["X-Requested-With"]}]),KMCServices.factory("playerCache",["$cacheFactory",function(a){return a("playerCache",{capacity:10})}]),KMCServices.factory("sortSvc",[function(){var a={},b={},c=function(b){this.name=b,this.elements=[],a[b]=this};return c.prototype.addElement=function(a){this.elements.push(a)},c.prototype.callObjectsUpdate=function(){angular.forEach(this.elements,function(a){cl(a.sortVal+" "+a.model)})},c.prototype.removeElement=function(a){var b=this.elements.indexOf(a);-1!=b&&this.elements.splice(b,1)},b.sortScope="",b.register=function(b,d){var e="undefined"==typeof a[b]?new c(b):a[b];e.addElement(d)},b.update=function(d,e,f){var g=a[e],h=a[d]?a[d]:new c(d);g&&g.removeElement(f),h.addElement(f),"object"==typeof b.sortScope&&b.sortScope.$broadcast("sortContainersChanged")},b.getObjects=function(){return a},b.saveOrder=function(b){a=b,angular.forEach(a,function(a){a.callObjectsUpdate()})},b}]),KMCServices.factory("PlayerService",["$http","$modal","$log","$q","apiService","$filter",function(a,b,c,d,e,f){var g=[],h={},i="0_ji4qh61l",j={setPreviewEntry:function(a){i=a},renderPlayer:function(){if(h&&"undefined"!=typeof kWidget){var a=$("html").hasClass("IE8")?{wmode:"transparent"}:{};kWidget.embed({targetId:"kVideoTarget",wid:"_"+h.partnerId,uiconf_id:h.id,flashvars:a,entry_id:i})}},playerRefresh:function(a){"aspectToggle"==a&&$("#spacer").toggleClass("narrow"),j.renderPlayer()},newPlayer:function(){var a=d.defer(),b={service:"uiConf",action:"add","uiConf:objectType":"KalturaUiConf","uiConf:objType":1,"uiConf:creationMode":2};return e.doRequest(b).then(function(b){a.resolve(b)},function(b){a.reject(b)}),a.promise},getPlayer:function(a){var b=!1,c=d.defer();if("undefined"!=typeof h.id&&(h.id==a||"currentEdit"==a)&&(c.resolve(h),b=!0),!b)for(var f=0;f<g.length;f++)g[f].id==a&&(c.resolve(g[f]),h=g[f],b=!0);if(!b){var i={service:"uiConf",action:"get",id:a};e.doRequest(i).then(function(a){c.resolve(a),h=a})}return c.promise},cachePlayers:function(a){$.isArray(a)?g=g.concat(a):g.push(a)},deletePlayer:function(a){var b=d.defer(),c=f("i18n")("Delete action was rejected at API level, perhaps a permission problem?");if("undefined"==typeof a&&h&&(a=h.id),a){var g={service:"uiConf",action:"delete",id:a};e.doRequest(g).then(function(a){b.resolve(a)},function(){b.reject(c)})}else b.reject(c);return b.promise},getRequiredVersion:function(){return 2},getPlayers:function(){return a.get("js/services/allplayers.json")},playerUpdate:function(a){var d="<span>Updating the player -- TEXT MISSING -- current version </span>",e=b.open({templateUrl:"template/dialog/message.html",controller:"ModalInstanceCtrl",resolve:{settings:function(){return{title:"Update confirmation",message:d+a.version}}}});e.result.then(function(b){b&&c.info("update modal confirmed for item version "+a.version+"at: "+new Date)},function(){c.info("update modal dismissed at: "+new Date)})}};return j}]),KMCServices.factory("requestNotificationChannel",["$rootScope",function(a){var b="_START_REQUEST_",c="_END_REQUEST_",d={customStart:null};return d.requestStarted=function(c){a.$broadcast(b),c&&(d.customStart=c)},d.requestEnded=function(b){if(d.customStart){if(b!=d.customStart)return;a.$broadcast(c),d.customStart=null}else a.$broadcast(c)},d.onRequestStarted=function(a,c){a.$on(b,function(){c()
})},d.onRequestEnded=function(a,b){a.$on(c,function(){b()})},d}]),KMCServices.directive("loadingWidget",["requestNotificationChannel",function(a){return{restrict:"EA",scope:{},replace:!0,template:"<div class='loadingOverlay'><a><div id='spinWrapper'></div></a></div>",controller:["$scope","$element",function(a,b){a.spinner=null,a.spinRunning=!1,a.opts={lines:15,length:27,width:8,radius:60,corners:1,rotate:0,direction:1,color:"#000",speed:.6,trail:24,shadow:!0,hwaccel:!0,className:"spinner",zIndex:2e9,top:"auto",left:"auto"};var c=function(){a.spinner=new Spinner(a.opts).spin()};a.endSpin=function(){a.spinner&&a.spinner.stop(),a.spinRunning=!1},a.spin=function(){if(!a.spinRunning){var d=b.find("#spinWrapper");null==a.spinner&&c(),a.spinner.spin(d[0]),a.spinRunning=!0}}}],link:function(b,c){c.hide();var d=function(){c.show(),b.spin()},e=function(){c.hide(),b.endSpin()};a.onRequestStarted(b,d),a.onRequestEnded(b,e)}}}]),KMCServices.factory("editableProperties",["$http",function(a){return a.get("js/services/editableProperties.json")}]),KMCServices.factory("apiService",["$q","$timeout","$location","localStorageService","playerCache","requestNotificationChannel",function(a,b,c,d,e,f){return{apiObj:null,getClient:function(){return this.apiObj||(kWidget.api.prototype.type="POST",this.apiObj=new kWidget.api),this.apiObj},unSetks:function(){delete this.apiObj},setKs:function(a){this.getClient().setKs(a)},setWid:function(a){this.getClient().wid=a},getKey:function(a){var b="";for(var c in a)b+=a[c]+"_";return b},listMedia:function(){var a={service:"media",action:"list"};return this.doRequest(a)},doRequest:function(g){var h=a.defer();f.requestStarted();var i=this.getKey(g);return e.get(i)?h.resolve(e.get(i)):this.getClient().doRequest(g,function(a){b(function(){a.code?("INVALID_KS"==a.code&&(d.remove("ks"),c.path("/login")),f.requestEnded(),h.reject(a.code)):(e.put(i,a),f.requestEnded(),h.resolve(a))},0)}),h.promise}}}]),KMCServices.factory("playerTemplates",["$http",function(a){return{listSystem:function(){return a.get("http://mrjson.com/data/5263e32d85f7fef869f2a63b/template/list.json")},listUser:function(){return a.get("http://mrjson.com/data/5263e32d85f7fef869f2a63b/userTemplates/list.json")}}}]);